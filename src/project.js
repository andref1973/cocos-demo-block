window.__require=function o(t,c,i){function n(a,s){if(!c[a]){if(!t[a]){var r=a.split("/");if(r=r[r.length-1],!t[r]){var h="function"==typeof __require&&__require;if(!s&&h)return h(r,!0);if(e)return e(r,!0);throw new Error("Cannot find module '"+a+"'")}a=r}var u=c[a]={exports:{}};t[a][0].call(u.exports,function(o){return n(t[a][1][o]||o)},u,u.exports,o,t,c,i)}return c[a].exports}for(var e="function"==typeof __require&&__require,a=0;a<i.length;a++)n(i[a]);return n}({"login-canvas":[function(o,t,c){"use strict";cc._RF.push(t,"39cbdeQgkNDZIVot+0IQ+Xp","login-canvas"),cc.Class({extends:cc.Component,properties:{startButton:cc.Node},start:function(){var o=cc.repeatForever(cc.sequence(cc.rotateBy(.3,4),cc.rotateBy(.6,-8),cc.rotateBy(.3,4),cc.delayTime(.5)));this.startButton.runAction(o)},toMainScene:function(){cc.director.loadScene("main")}}),cc._RF.pop()},{}],"login-music":[function(o,t,c){"use strict";cc._RF.push(t,"ce3a95Kl5lBZbozYSTVzEKo","login-music"),cc.Class({extends:cc.Component,properties:{bgm:{type:cc.AudioClip,default:null}},start:function(){cc.audioEngine.isMusicPlaying()||cc.audioEngine.playMusic(this.bgm,!0)}}),cc._RF.pop()},{}],"main-blockManager":[function(o,t,c){"use strict";cc._RF.push(t,"5990c+N1GNA14+X5FxiVL7P","main-blockManager"),cc.Class({extends:cc.Component,properties:function(){return{blockPrefab:cc.Prefab,blockSpriteFrames:[cc.SpriteFrame],mainCanvas:o("main-canvas"),musicRoot:o("main-music")}},onLoad:function(){this.init(),this.pool=new cc.NodePool;for(var o=0;o<30;o++)this.pool.put(cc.instantiate(this.blockPrefab));this.count=0,this.hits=0},start:function(){this.gameStart()},mapForCount:function(o,t,c){for(var i=[[0,1],[1,0],[0,-1],[-1,0]],n=0;n<4;n++){var e=o+i[n][0],a=t+i[n][1];e<1||e>5||a<1||a>5||this.map[e][a]===c&&0===this.book[e][a]&&(this.book[e][a]=1,this.count+=1,this.mapForCount(e,a,c))}},doActionForBook:function(o,t){var c=this;this.mainCanvas.updateScoreLabel(this.count,this.map[o][t]);for(var i=function(i){for(var n=function(n){if(i===o&&n===t)return"continue";1===c.book[i][n]&&c.mapNode[i][n].runAction(cc.sequence(cc.scaleTo(.15,0),cc.callFunc(function(){c.pool.put(c.mapNode[i][n]),c.map[i][n]=null,c.mapNode[i][n]=null},c)))},e=1;e<6;e++)n(e)},n=1;n<6;n++)i(n);this.mapNode[o][t].runAction(cc.sequence(cc.scaleTo(.15,1.2),cc.callFunc(function(){c.blockAddOne(o,t)},this),cc.scaleTo(.15,1),cc.callFunc(function(){c.blockDown()},this))),this.mainCanvas.hp+=1,this.mainCanvas.updateHpShow(this.mainCanvas.hp),this.musicRoot.playCombo(this.hits),this.hits+=1},blockDown:function(){for(var o=!0;o;){o=!1;for(var t=1;t<6;t++)for(var c=1;c<5;c++)null!==this.mapNode[t][c]&&null===this.mapNode[t][c+1]&&(this.mapNode[t][c].runAction(cc.moveBy(.1,0,-130)),this.mapNode[t][c+1]=this.mapNode[t][c],this.map[t][c+1]=this.map[t][c],this.mapNode[t][c]=null,this.map[t][c]=null,o=!0)}this.scheduleOnce(this.checkNullBlock,.3)},checkNullBlock:function(){for(var o=1;o<6;o++)for(var t=1;t<6;t++)if(null===this.mapNode[o][t]){var c=this.randNum(0,4),i=130*(o-1)-260,n=260-130*(t-1);this.map[o][t]=c,this.mapNode[o][t]=this.createBlock(i,n,c),this.mapNode[o][t].scale=0,this.mapNode[o][t].runAction(cc.scaleTo(.1,1))}this.scheduleOnce(this.checkCount,.3)},checkCount:function(){for(var o=!0,t=1;t<6;t++)for(var c=1;c<6&&!1!==o;c++)this.count=0,this.setZeroBook(),this.mapForCount(t,c,this.map[t][c]),this.count>=3&&(this.doActionForBook(t,c),o=!1);!0===o&&this.mainCanvas.openTouch()},blockAddOne:function(o,t){if(8===this.map[o][t])return console.log("\u52309\u4e86"),!1;this.map[o][t]+=1;var c=this.map[o][t];return this.mapNode[o][t].getComponent(cc.Sprite).spriteFrame=this.blockSpriteFrames[c],!0},gameStart:function(){for(var o=1;o<6;o++)for(var t=1;t<6;t++){var c=130*(o-1)-260,i=260-130*(t-1),n=this.randNum(0,4);for(this.map[o][t]=n;this.map[o][t]===this.map[o-1][t]||this.map[o][t]===this.map[o][t-1]||this.map[o][t]===this.map[o+1][t]||this.map[o][t]===this.map[o][t+1];)n=this.randNum(0,4),this.map[o][t]=n;this.mapNode[o][t]=this.createBlock(c,i,n)}},createBlock:function(o,t,c){var i=null;return(i=this.pool.size()>0?this.pool.get():cc.instantiate(this.blockPrefab)).parent=this.node,i.x=o,i.y=t,i.getComponent(cc.Sprite).spriteFrame=this.blockSpriteFrames[c],i},init:function(){this.map=[],this.mapNode=[],this.book=[];for(var o=0;o<7;o++){this.map[o]=[],this.mapNode[o]=[],this.book[o]=[];for(var t=0;t<7;t++)this.map[o][t]=null,this.mapNode[o][t]=null,this.book[o][t]=0}},setZeroBook:function(){for(var o=0;o<7;o++)for(var t=0;t<7;t++)this.book[o][t]=0},randNum:function(o,t){var c=o+(t-o+1)*Math.random();return Math.floor(c)}}),cc._RF.pop()},{"main-canvas":"main-canvas","main-music":"main-music"}],"main-canvas":[function(o,t,c){"use strict";cc._RF.push(t,"3e6aa5knvxLTIfxXUPSpveC","main-canvas"),cc.Class({extends:cc.Component,properties:function(){return{hpManager:cc.Node,showScoreLabel:cc.Label,blockManager:o("main-blockManager"),musicRoot:o("main-music")}},onLoad:function(){this.hp=5,this.score=0},start:function(){this.openTouch(),this.updateHpShow(this.hp)},touchEnd:function(o){this.musicRoot.playHit();var t=this.node.convertToNodeSpaceAR(o.getLocation()),c=Math.floor((325+t.x)/130)+1,i=Math.floor((325-t.y)/130)+1;if(c<1||c>5||i<1||i>5)console.log("\u4e0d\u5728\u8303\u56f4\u5185");else if(this.blockManager.blockAddOne(c,i)){this.hp-=1,this.hp<0&&(console.log("\u6e38\u620f\u7ed3\u675f"),this.musicRoot.playOver(),this.scheduleOnce(function(){cc.director.loadScene("login")},1)),this.updateHpShow(this.hp),this.closeTouch(),this.blockManager.count=0,this.blockManager.setZeroBook();var n=this.blockManager.map[c][i];this.blockManager.mapForCount(c,i,n),this.blockManager.count<3?this.openTouch():(this.blockManager.hits=0,this.blockManager.doActionForBook(c,i))}},updateHpShow:function(o){o<0&&(o=0),o>5&&(o=5);for(var t=0;t<5;t++)this.hpManager.children[t].opacity=0;for(var c=0;c<o;c++)this.hpManager.children[c].opacity=255},updateScoreLabel:function(o,t){var c=this;this.showScoreLabel.node.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.callFunc(function(){c.score+=(t+1)*o,c.showScoreLabel.string=c.score+""},this),cc.scaleTo(.1,1)))},openTouch:function(){this.node.on(cc.Node.EventType.TOUCH_END,this.touchEnd,this)},closeTouch:function(){this.node.off(cc.Node.EventType.TOUCH_END,this.touchEnd,this)}}),cc._RF.pop()},{"main-blockManager":"main-blockManager","main-music":"main-music"}],"main-music":[function(o,t,c){"use strict";cc._RF.push(t,"f8052tIhtxBZbf16MdGvRRt","main-music"),cc.Class({extends:cc.Component,properties:{hit:{type:cc.AudioClip,default:null},over:{type:cc.AudioClip,default:null},combo:{type:[cc.AudioClip],default:[]}},playCombo:function(o){o<0||(o>5&&(o=5),cc.audioEngine.playEffect(this.combo[o],!1))},playHit:function(){cc.audioEngine.playEffect(this.hit,!1)},playOver:function(){cc.audioEngine.playEffect(this.over,!1)}}),cc._RF.pop()},{}],"use_v2.0.x_cc.Toggle_event":[function(o,t,c){"use strict";cc._RF.push(t,"9f4705nS3NPUpIc32n18uSz","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["use_v2.0.x_cc.Toggle_event","login-canvas","login-music","main-blockManager","main-canvas","main-music"]);